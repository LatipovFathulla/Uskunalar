{% load tags %}
{% load static %}
{% load i18n %}
{% load humanize %}
{% load static watermark %}
{% block content %}
        <!-- Product Card -->
        <div class="us-products-card">
            <div class="us-products-card_container">
                <!-- Buttons -->
                <div class="us-products-card_buttons" >
                        {% if product.is_discount %}
                            <span class="us-mobile-products-horizontal-card-discount">-{{ product.discount }}%</span>
                         {% endif %}
                    <a onclick="add_to_wishlist(this, {{ product.pk }})">
                         {% if product|in_wishlist:request %}
                                <button class="us-products-card_ibutton product-heart" type="submit"><i class="fa-solid fa-heart red-heart"></i></button>
                          {% else %}
                                <button class="us-products-card_ibutton" type="submit"><i class="fa-light fa-heart"></i></button>
                          {% endif %}
                    </a>

                </div>

                <!-- Img -->
                          <div class="us-products-card_img-holder">
                            <div class="us-products-card_img_back" style="background: url('{{ product.background.image.url }}') no-repeat center center / contain;">
                            <p>{{ product.background_color }}</p>
                            {% for i in product.images.all %}
                                <a href="{% url 'products:single' pk=product.pk %}">
                                    {% if forloop.counter == 1 %}
                                         <img src="{{ i.image.url }}" alt="" class="us-products-card_img">
                                    {% endif %}
                                </a>
                            {% endfor %}
                            </div>
                        </div>


                <!-- Details Section -->
                <div class="us-products-card-details">
                     <a href="{% url 'products:single' pk=product.pk %}">
                        <h2 class="us-products-card-title">{{ product.title }}</h2>
                     </a>
                    <!-- omborda mavjud -->
                    <!-- <p class="us-products-card-product_status"><i class="fa-solid fa-circle"></i> omborda mavjud</p> -->
                    <!-- buyurtmaga -->
                   {% if product.delivery %}
                    <p class="us-products-card-product_status not-exists"><i class="fa-solid fa-circle" style="padding: 3px"></i>{{ product.delivery}}</p>
                   {% endif %}
                   {% if product.inbox %}
                       <p class="us-products-card-product_status"><i class="fa-solid fa-circle" style="padding: 3px"></i>{{ product.inbox}}</p>
                   {% endif %}

                    <ul class="us-products-card-details_list">
                     {% for j in product.specifications.all|slice:':4' %}
                        <li class="us-products-card-details_item">
                        {% if j.product_customer %}
                            <h4 class="us-products-card-detailname">{{ j.product_customer|safe }}:</h4>
                        {% endif %}
                         {% if j.product_number %}
                            <p class="us-products-card-detail">{{ j.product_number|safe }}</p>
                        {% endif %}
                        </li>
                     {% endfor %}
                    </ul>
                </div>

                <!-- Country -->
                <div class="us-products-card-country_container">
                    <p class="us-products-card-countryName">{% trans 'Mamlakat' %}:</p>
                    <img src="{{ product.country.image.url }}" alt="" class="us-products-car-countryImg">
                </div>

                <div class="us-products-card-status">
                    <div class="us-products-card-priceInfo">
                       <div class="us-products-card-priceabout">
                           {% if product.CIP == True %}
                                     <span title="INNKOTERMS - 2022 bo'yicha CIP Taskent" class="us-products-card-term cip-term">CIP</span>
                           {% elif product.DAF == True %}
                                     <span title="INNKOTERMS - 2022 bo'yicha CIP Taskent" class="us-products-card-term daf-term">DAF</span>
                           {% elif product.EXW == True %}
                                     <span title="INNKOTERMS - 2022 bo'yicha CIP Taskent" class="us-products-card-term exw-term">EXW</span>
                           {% elif product.FCA == True %}
                                    <span title="INNKOTERMS - 2022 bo'yicha CIP Taskent" class="us-products-card-term fca-term">FCA</span>
                           {% endif %}
                            <h3 class="us-products-card-productPrice_dollar">${{ product.get_price }}</h3>
                        </div>
                        <p class="us-products-card-productPrice_som"><span> </span> so'm</p>
                    </div>
                    <div class="us-products-card-statusinfo">
                        <h3 class="us-products-card-product_id">ID:{{ product.sku }}</h3>
                    </div>
                </div>

                <!-- More Details Button -->

            </div>
                <a href="{% url 'products:single' pk=product.pk %}" class="us_products_button_div us-products-card_buttonMore ">{% trans 'More Details' %}</a>
        </div>
        <!-- end product card -->


{% block extra_js %}
<script>
  function addUrlParameter(name, value) {
      let searchParams = new URLSearchParams(window.location.search)
      if (['category'].includes(name)) {
          searchParams.delete('?');
      }
      if (searchParams.has(name) && searchParams.get(name) === value) {
          searchParams.delete(name);
      } else {
          searchParams.set(name, value)
      }
      window.location.search = searchParams.toString()
  }
</script>

<script>
    function add_to_wishlist(element, pk) {
        $.getJSON('/products/' + "wishlist/" + pk, function (data) {
            if (!data.status) {
               $('#message').append(`<div style="padding:5px">
                        <div id="inner-message" class="alert alert-error">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            Error
                        </div>
                    </div>`);
            } else {
                if (data.added) {
                    element.innerHTML = '<button class="us-products-card_ibutton product-heart" type="submit"><i class="fa-solid fa-heart red-heart"></i></button>'
                } else {
                    element.innerHTML = '<button class="us-products-card_ibutton" type="submit"><i class="fa-light fa-heart"></i></button>'
                }
                  $('#like_count').html(data.wishlist_len);
                  $('#like_count_2').html(data.wishlist_len);
            }
        });
    }
</script>

{% endblock %}
{% endblock %}